# ----------------------------------------------------------------------
# D√©sactiver l'indexation des dossiers
# ----------------------------------------------------------------------
Options -Indexes

# ----------------------------------------------------------------------
# Activation du moteur de r√©√©criture
# ----------------------------------------------------------------------
<IfModule mod_rewrite.c>
    Options +FollowSymlinks
    RewriteEngine On

    # üîπ Si CodeIgniter est dans un sous-dossier, d√©commente et adapte cette ligne :
    # RewriteBase /mon-sous-dossier/

    # üîπ Redirection des slashes en trop (ex: /page/ -> /page)
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} (.+)/$
    RewriteRule ^ %1 [L,R=301]

    # üîπ Suppression de "www" pour uniformiser l'URL (d√©commente pour en ligne)
    # RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
    # RewriteRule ^ http://%1%{REQUEST_URI} [R=301,L]

    # üîπ Redirection vers HTTPS (‚ö†Ô∏è D√©commente UNIQUEMENT pour la mise en ligne)
    # RewriteCond %{HTTPS} !=on
    # RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

    # üîπ Envoi des requ√™tes vers index.php si le fichier/dossier n'existe pas
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^([\s\S]*)$ index.php/$1 [L,NC,QSA]

    # üîπ Assurer que l'en-t√™te Authorization est bien transmis (utile pour les API REST)
    RewriteCond %{HTTP:Authorization} .
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
</IfModule>

<IfModule !mod_rewrite.c>
    # üîπ Si mod_rewrite n'est pas dispo, renvoyer toutes les 404 vers index.php
    ErrorDocument 404 index.php
</IfModule>

# ----------------------------------------------------------------------
# üîê S√©curisation des fichiers sensibles (d√©j√† actif en local)
# ----------------------------------------------------------------------
<FilesMatch "^(.*)\.(env|ini|log|sh|sql|bak|config|json|lock)$">
    Require all denied
</FilesMatch>

# ----------------------------------------------------------------------
# üîê Protection contre l'ex√©cution de PHP dans uploads (‚ö†Ô∏è Active seulement en ligne)
# ----------------------------------------------------------------------
# <Directory "/writable/uploads/">
#     <FilesMatch "\.php$">
#         Require all denied
#     </FilesMatch>
# </Directory>

# ----------------------------------------------------------------------
# üîê S√©curit√© HTTP (‚ö†Ô∏è √Ä activer en ligne uniquement)
# ----------------------------------------------------------------------
# <IfModule mod_headers.c>
#     Header always set X-Frame-Options "DENY"
#     Header always set X-XSS-Protection "1; mode=block"
#     Header always set X-Content-Type-Options "nosniff"
#     Header always set Referrer-Policy "strict-origin-when-cross-origin"
#     Header always set Content-Security-Policy "default-src 'self'"
# </IfModule>

# ----------------------------------------------------------------------
# üîπ D√©sactivation de la signature Apache (d√©j√† actif en local)
# ----------------------------------------------------------------------
ServerSignature Off